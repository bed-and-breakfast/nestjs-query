"use strict";(self.webpackChunknestjs_query=self.webpackChunknestjs_query||[]).push([[5586],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=s(n),c=i,g=m["".concat(p,".").concat(c)]||m[c]||u[c]||l;return n?a.createElement(g,r(r({ref:t},d),{},{components:n})):a.createElement(g,r({ref:t},d))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,r=new Array(l);r[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[m]="string"==typeof e?e:i,r[1]=o;for(var s=2;s<l;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3314:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),i=n(6010);const l={tabItem:"tabItem_Ymn6"};function r(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(l.tabItem,r),hidden:n},t)}},1291:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(7462),i=n(7294),l=n(6010),r=n(2389),o=n(7392),p=n(7094),s=n(2466);const d={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function m(e){var t,n,r=e.lazy,m=e.block,u=e.defaultValue,c=e.values,g=e.groupId,h=e.className,f=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=c?c:f.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),y=(0,o.l)(k,(function(e,t){return e.value===t.value}));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===u?u:null!=(t=null!=u?u:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:f[0].props.value;if(null!==b&&!k.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+k.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=(0,p.U)(),F=N.tabGroupChoices,T=N.setTabGroupChoices,I=(0,i.useState)(b),D=I[0],C=I[1],O=[],v=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=g){var q=F[g];null!=q&&q!==D&&k.some((function(e){return e.value===q}))&&C(q)}var w=function(e){var t=e.currentTarget,n=O.indexOf(t),a=k[n].value;a!==D&&(v(t),C(a),null!=g&&T(g,String(a)))},S=function(e){var t,n=null;switch(e.key){case"Enter":w(e);break;case"ArrowRight":var a,i=O.indexOf(e.currentTarget)+1;n=null!=(a=O[i])?a:O[0];break;case"ArrowLeft":var l,r=O.indexOf(e.currentTarget)-1;n=null!=(l=O[r])?l:O[O.length-1]}null==(t=n)||t.focus()};return i.createElement("div",{className:(0,l.Z)("tabs-container",d.tabList)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":m},h)},k.map((function(e){var t=e.value,n=e.label,r=e.attributes;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:D===t?0:-1,"aria-selected":D===t,key:t,ref:function(e){return O.push(e)},onKeyDown:S,onClick:w},r,{className:(0,l.Z)("tabs__item",d.tabItem,null==r?void 0:r.className,{"tabs__item--active":D===t})}),null!=n?n:t)}))),r?(0,i.cloneElement)(f.filter((function(e){return e.props.value===D}))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},f.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==D})}))))}function u(e){var t=(0,r.Z)();return i.createElement(m,(0,a.Z)({key:String(t)},e))}},2872:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>f,frontMatter:()=>s,metadata:()=>m,toc:()=>c});var a=n(7462),i=n(3366),l=(n(7294),n(3905)),r=n(1291),o=n(3314),p=["components"],s={title:"DTOs"},d=void 0,m={unversionedId:"graphql/dtos",id:"graphql/dtos",title:"DTOs",description:"The query-graphql package leverages most decorators from @nestjs/graphql and TypeGraphQL, with the exception of FilterableField.",source:"@site/docs/graphql/dtos.mdx",sourceDirName:"graphql",slug:"/graphql/dtos",permalink:"/nestjs-query/docs/graphql/dtos",draft:!1,editUrl:"https://github.com/tripss/nestjs-query/edit/master/documentation/docs/graphql/dtos.mdx",tags:[],version:"current",frontMatter:{title:"DTOs"},sidebar:"docs",previous:{title:"Getting Started",permalink:"/nestjs-query/docs/graphql/getting-started"},next:{title:"Resolvers",permalink:"/nestjs-query/docs/graphql/resolvers"}},u={},c=[{value:"<code>@FilterableField</code>",id:"filterablefield",level:2},{value:"Options",id:"options",level:3},{value:"Example",id:"example",level:3},{value:"Example - allowedComparisons",id:"example---allowedcomparisons",level:3},{value:"Example - filterRequired",id:"example---filterrequired",level:3},{value:"Example - filterOnly",id:"example---filteronly",level:3},{value:"<code>@IDField</code>",id:"idfield",level:2},{value:"Example",id:"example-1",level:3},{value:"Example - Disable Filtering",id:"example---disable-filtering",level:3},{value:"<code>@QueryOptions</code>",id:"queryoptions",level:2},{value:"Setting a default Filter",id:"setting-a-default-filter",level:3},{value:"Result Page Size",id:"result-page-size",level:3},{value:"Limiting Results Size",id:"limiting-results-size",level:3},{value:"Paging Strategy",id:"paging-strategy",level:3},{value:"Paging with Total Count",id:"paging-with-total-count",level:3},{value:"Default Sort",id:"default-sort",level:3},{value:"Allowed Boolean Expressions",id:"allowed-boolean-expressions",level:3}],g={toc:c},h="wrapper";function f(e){var t=e.components,n=(0,i.Z)(e,p);return(0,l.kt)(h,(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"query-graphql")," package leverages most decorators from ",(0,l.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/graphql/quick-start"},(0,l.kt)("inlineCode",{parentName:"a"},"@nestjs/graphql"))," and ",(0,l.kt)("a",{parentName:"p",href:"https://typegraphql.ml"},"TypeGraphQL"),", with the exception of ",(0,l.kt)("inlineCode",{parentName:"p"},"FilterableField"),"."),(0,l.kt)("h2",{id:"filterablefield"},(0,l.kt)("inlineCode",{parentName:"h2"},"@FilterableField")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"FilterableField")," is very similar to the ",(0,l.kt)("a",{parentName:"p",href:"https://typegraphql.ml/docs/types-and-fields.html"},(0,l.kt)("inlineCode",{parentName:"a"},"Field"))," from\nTypeGraphQL, however it allows you to specify the fields that should be filterable when querying."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"If you use the @nestjs/graphql ",(0,l.kt)("inlineCode",{parentName:"p"},"Field")," decorator it will not be exposed in the query type for the DTO.")),(0,l.kt)("h3",{id:"options"},"Options"),(0,l.kt)("p",null,"In addition to the normal field options you can also specify the following options"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"allowedComparisons")," - An array of allowed comparisons. You can use this option to allow a subset of filter comparisons when querying through graphql.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"This option is useful if the field is expensive to query on for certain operators, or your data source supports a limited set of comparisons."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"filterRequired")," - When set to ",(0,l.kt)("inlineCode",{parentName:"li"},"true")," the field will be required whenever a ",(0,l.kt)("inlineCode",{parentName:"li"},"filter")," is used. The ",(0,l.kt)("inlineCode",{parentName:"li"},"filter")," requirement applies to all ",(0,l.kt)("inlineCode",{parentName:"li"},"read"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"update"),", and ",(0,l.kt)("inlineCode",{parentName:"li"},"delete")," endpoints that use a ",(0,l.kt)("inlineCode",{parentName:"li"},"filter"),".",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"The ",(0,l.kt)("inlineCode",{parentName:"li"},"filterRequired")," option is useful when your entity has an index that requires a subset of fields to be used to provide certain level of query performance."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"NOTE"),": When a field is a required in a filter the default ",(0,l.kt)("inlineCode",{parentName:"li"},"filter")," option is ignored."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"filterOnly"),"- When set to ",(0,l.kt)("inlineCode",{parentName:"li"},"true"),", the field will only appear as ",(0,l.kt)("inlineCode",{parentName:"li"},"filter")," but isn't included as field inside the ",(0,l.kt)("inlineCode",{parentName:"li"},"ObjectType"),".",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"This option is useful if you want to filter on foreign keys without resolving the relation but you don't want to have the foreign key show up as field in your query type for the DTO. This might be especially useful for ",(0,l.kt)("a",{parentName:"li",href:"/nestjs-query/docs/graphql/federation#reference-decorator"},"federated relations"))))),(0,l.kt)("h3",{id:"example"},"Example"),(0,l.kt)("p",null,"In the following example we allow ",(0,l.kt)("inlineCode",{parentName:"p"},"id"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"title"),", and ",(0,l.kt)("inlineCode",{parentName:"p"},"completed")," to be used in queries."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts"',title:'"todo-item.dto.ts"'},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h3",{id:"example---allowedcomparisons"},"Example - allowedComparisons"),(0,l.kt)("p",null,"In the following example the ",(0,l.kt)("inlineCode",{parentName:"p"},"allowedComparisons")," option is demonstrated by restricting the comparisons that are allowed when filtering on certain fields."),(0,l.kt)("p",null,"For the ",(0,l.kt)("inlineCode",{parentName:"p"},"id")," field only ",(0,l.kt)("inlineCode",{parentName:"p"},"eq"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"neq"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"in"),", and ",(0,l.kt)("inlineCode",{parentName:"p"},"notIn")," comparisons will be exposed in the schema."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"title")," field will only allow ",(0,l.kt)("inlineCode",{parentName:"p"},"eq"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"like"),", and ",(0,l.kt)("inlineCode",{parentName:"p"},"notLike"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {6,9}',title:'"todo-item.dto.ts"',"{6,9}":!0},"import { FilterableField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => ID, { allowedComparisons: ['eq', 'neq', 'in', 'notIn'] })\n  id!: string;\n\n  @FilterableField({ allowedComparisons: ['eq', 'like', 'notLike'] })\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h3",{id:"example---filterrequired"},"Example - filterRequired"),(0,l.kt)("p",null,"In the following example the ",(0,l.kt)("inlineCode",{parentName:"p"},"filterRequired")," option is applied to the ",(0,l.kt)("inlineCode",{parentName:"p"},"completed")," field, ensuring that all endpoints that use a filter will require a comparison on the ",(0,l.kt)("inlineCode",{parentName:"p"},"completed")," field."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {12}',title:'"todo-item.dto.ts"',"{12}":!0},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ filterRequired: true })\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n")),(0,l.kt)("h3",{id:"example---filteronly"},"Example - filterOnly"),(0,l.kt)("p",null,"In the following example the ",(0,l.kt)("inlineCode",{parentName:"p"},"filterOnly")," option is applied to the ",(0,l.kt)("inlineCode",{parentName:"p"},"assigneeId")," field, which makes a query filterable\nby the id of an assigned user but won't return the ",(0,l.kt)("inlineCode",{parentName:"p"},"assigneeId")," as field."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts"',title:'"todo-item.dto.ts"'},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@Relation('assignee', () => UserDTO)\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField({ filterOnly: true })\n  assigneeId!: string;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n")),(0,l.kt)("h2",{id:"idfield"},(0,l.kt)("inlineCode",{parentName:"h2"},"@IDField")),(0,l.kt)("p",null,"By default ",(0,l.kt)("inlineCode",{parentName:"p"},"nestjs-query")," uses the default graphql ",(0,l.kt)("inlineCode",{parentName:"p"},"ID")," scalar, if you need to use a different ",(0,l.kt)("inlineCode",{parentName:"p"},"graphql")," ",(0,l.kt)("inlineCode",{parentName:"p"},"scalar"),"\ntype you can  ",(0,l.kt)("inlineCode",{parentName:"p"},"@IDField")," decorator. ",(0,l.kt)("inlineCode",{parentName:"p"},"nestjs-query")," will ",(0,l.kt)("inlineCode",{parentName:"p"},"scalar")," type passed to the ",(0,l.kt)("inlineCode",{parentName:"p"},"@IDField")," for all auto-generated\n",(0,l.kt)("inlineCode",{parentName:"p"},"query")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"mutation")," endpoints that rely on an input for the ",(0,l.kt)("inlineCode",{parentName:"p"},"id")," (e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"findById"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"updateOne"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"deleteOne"),")."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"The ",(0,l.kt)("inlineCode",{parentName:"p"},"@IDField")," uses the same options as ",(0,l.kt)("inlineCode",{parentName:"p"},"@FilterableField"),".")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"You may have seen ",(0,l.kt)("inlineCode",{parentName:"p"},"@IDField")," in various examples throughout the docs, this is because we recommend using ",(0,l.kt)("inlineCode",{parentName:"p"},"@IDField"),"\nby default. In the future if you need to change the type later on it should be a trivial change to find all fields\nthat use the ",(0,l.kt)("inlineCode",{parentName:"p"},"@IDField")," decorator to update.")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"If you are using ",(0,l.kt)("inlineCode",{parentName:"p"},"query-typegoose"),'there is a known "won\'t fix" bug with ',(0,l.kt)("inlineCode",{parentName:"p"},"class-transformer"),", where ObjectIds end up getting new values, instead of the hex value they should be. To remedy this, we have a special decorator called '@ObjectId`. So, DTO's should use this as follow:"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"import { Field, GraphQLISODateTime, ID, ObjectType } from '@nestjs/graphql'\nimport { CursorConnection, FilterableField, KeySet, ObjectId, QueryOptions } from '@ptc-org/nestjs-query-graphql'\nimport mongoose from 'mongoose'\n\nimport { AuthGuard } from '../../auth.guard'\nimport { SubTaskDTO } from '../../sub-task/dto/sub-task.dto'\nimport { TagDTO } from '../../tag/dto/tag.dto'\n\n@ObjectType('TodoItem')\n@KeySet(['id'])\n@QueryOptions({ enableTotalCount: true })\n@CursorConnection('subTasks', () => SubTaskDTO, { disableRemove: true, guards: [AuthGuard] })\n@CursorConnection('tags', () => TagDTO, { guards: [AuthGuard] })\nexport class TodoItemDTO {\n  @ObjectId()\n  _id: mongoose.Types.ObjectId\n")),(0,l.kt)("p",{parentName:"admonition"},"Notice the last two lines of code.")),(0,l.kt)("h3",{id:"example-1"},"Example"),(0,l.kt)("p",null,"A common use case is to obscure an auto-incremented primary key."),(0,l.kt)("p",null,"In this example we'll do a simple version of that by declaring a new ",(0,l.kt)("inlineCode",{parentName:"p"},"ID")," scalar that will ",(0,l.kt)("inlineCode",{parentName:"p"},"base64")," encode all ids."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="common/custom-id.scalar.ts" {11-12,16-17,21-25}',title:'"common/custom-id.scalar.ts"',"{11-12,16-17,21-25}":!0},"import { Scalar, CustomScalar } from '@nestjs/graphql';\nimport { Kind, ValueNode } from 'graphql';\n\n@Scalar('CustomID')\nexport class CustomIDScalar implements CustomScalar<string, number> {\n  description = 'ID custom scalar type';\n\n  private idPrefix = 'id:';\n\n  parseValue(value: string): number {\n    // parse a `base64` encoded id from the client when provided as a variable\n    return parseInt(Buffer.from(value, 'base64').toString('utf8').replace(this.idPrefix, ''), 10);\n  }\n\n  serialize(value: number): string {\n    // serialize a number into the base64 representation\n    return Buffer.from(`${this.idPrefix}${value}`, 'utf8').toString('base64');\n  }\n\n  parseLiteral(ast: ValueNode): number | null {\n    // parse a `base64` encoded id from the client when hardcoded into the query\n    if (ast.kind === Kind.STRING) {\n      return this.parseValue(ast.value);\n    }\n    return null;\n  }\n}\n\n")),(0,l.kt)("p",null,"Now lets register our ",(0,l.kt)("inlineCode",{parentName:"p"},"CustomID")," scalar with ",(0,l.kt)("inlineCode",{parentName:"p"},"nestjs"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="common/common.module.ts"',title:'"common/common.module.ts"'},"import { Module } from '@nestjs/common';\nimport { CustomIDScalar } from './custom-id.scalar';\n\n@Module({\n  providers: [CustomIDScalar],\n})\nexport class CommonModule {}\n")),(0,l.kt)("p",null,"Once your ",(0,l.kt)("inlineCode",{parentName:"p"},"CustomIDScalar")," is registered you can use it in your ",(0,l.kt)("inlineCode",{parentName:"p"},"DTOS"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item/dto/todo-item.dto.ts" {7}',title:'"todo-item/dto/todo-item.dto.ts"',"{7}":!0},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, GraphQLISODateTime } from '@nestjs/graphql';\nimport { CustomIDScalar } from '../../common/custom-id.scalar';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => CustomIDScalar)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime, { filterOnly: true })\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime, { filterOnly: true })\n  updated!: Date;\n}\n")),(0,l.kt)("p",null,"Now all ",(0,l.kt)("inlineCode",{parentName:"p"},"graphql")," endpoints that need to use an ",(0,l.kt)("inlineCode",{parentName:"p"},"id")," to query or mutate a ",(0,l.kt)("inlineCode",{parentName:"p"},"TodoItem")," will use the ",(0,l.kt)("inlineCode",{parentName:"p"},"CustomIDScalar"),"\ntype for the input."),(0,l.kt)("h3",{id:"example---disable-filtering"},"Example - Disable Filtering"),(0,l.kt)("p",null,"If you want to disable filtering and sorting on the ",(0,l.kt)("inlineCode",{parentName:"p"},"id")," field you can use the ",(0,l.kt)("inlineCode",{parentName:"p"},"disableFilter")," option."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item/dto/todo-item.dto.ts" {7}',title:'"todo-item/dto/todo-item.dto.ts"',"{7}":!0},"import { FilterableField, IDField } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, GraphQLISODateTime } from '@nestjs/graphql';\nimport { CustomIDScalar } from '../../common/custom-id.scalar';\n\n@ObjectType('TodoItem')\nexport class TodoItemDTO {\n  @IDField(() => CustomIDScalar, { disableFilter: true })\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField({ nullable: true })\n  description?: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @FilterableField(() => GraphQLISODateTime, { filterOnly: true })\n  created!: Date;\n\n  @FilterableField(() => GraphQLISODateTime, { filterOnly: true })\n  updated!: Date;\n}\n")),(0,l.kt)("h2",{id:"queryoptions"},(0,l.kt)("inlineCode",{parentName:"h2"},"@QueryOptions")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"@QueryOptions")," decorator can be used to override any defaults for querying functionality such as sorting,\nfiltering, paging strategy, etc."),(0,l.kt)("h3",{id:"setting-a-default-filter"},"Setting a default Filter"),(0,l.kt)("p",null,"When querying the default ",(0,l.kt)("inlineCode",{parentName:"p"},"filter")," is empty. You can specify a default filter by using the ",(0,l.kt)("inlineCode",{parentName:"p"},"QueryOptions")," decorator on\nyour DTO option."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"The default filter is only used when a filter is not provided in a query.")),(0,l.kt)("p",null,"In this example we specify the default filter to be ",(0,l.kt)("inlineCode",{parentName:"p"},"completed IS TRUE"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ defaultFilter: { completed: { is: true } } })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"result-page-size"},"Result Page Size"),(0,l.kt)("p",null,"By default all results will be limited to 10 records."),(0,l.kt)("p",null,"To override the default you can override the default page size by setting the ",(0,l.kt)("inlineCode",{parentName:"p"},"defaultResultSize")," option."),(0,l.kt)("p",null,"In this example we specify the ",(0,l.kt)("inlineCode",{parentName:"p"},"defaultResultSize")," to 5 which means if a page size is not specified 5 results will be\nreturned."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ defaultResultSize: 5 })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h3",{id:"limiting-results-size"},"Limiting Results Size"),(0,l.kt)("p",null,"By default the max number records that can be returned is ",(0,l.kt)("inlineCode",{parentName:"p"},"50"),"."),(0,l.kt)("p",null,"To override the default you can override the following options specifying the ",(0,l.kt)("inlineCode",{parentName:"p"},"maxResultSize")," option."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"You can disable ",(0,l.kt)("inlineCode",{parentName:"p"},"maxResultSize")," by setting the option to ",(0,l.kt)("inlineCode",{parentName:"p"},"-1"),".")),(0,l.kt)("p",null,"In this example we specify limit the max number of records an end user can request to 20."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ maxResultsSize: 20 })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"paging-strategy"},"Paging Strategy"),(0,l.kt)("p",null,"By default ",(0,l.kt)("inlineCode",{parentName:"p"},"nestjs-query")," uses a ",(0,l.kt)("inlineCode",{parentName:"p"},"cursor")," based paging strategy and returns a ",(0,l.kt)("a",{parentName:"p",href:"https://relay.dev/graphql/connections.htm"},"connection")," for all query many endpoints."),(0,l.kt)("p",null,"For a more in-depth overview of paging check out the ",(0,l.kt)("a",{parentName:"p",href:"/nestjs-query/docs/graphql/paging"},"paging docs")),(0,l.kt)("p",null,"You can override the default ",(0,l.kt)("inlineCode",{parentName:"p"},"pagingStrategy")," to one of the following alternatives"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"OFFSET")," - sets paging to allow ",(0,l.kt)("inlineCode",{parentName:"li"},"limit")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"offset")," fields, and returns an ",(0,l.kt)("inlineCode",{parentName:"li"},"OffsetConnection"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"NONE")," - turn off all paging and always return an ",(0,l.kt)("inlineCode",{parentName:"li"},"ArrayConnection"),".")),(0,l.kt)("p",null,"When using the ",(0,l.kt)("inlineCode",{parentName:"p"},"OFFSET")," strategy your the paging arguments for a many query will accept a ",(0,l.kt)("inlineCode",{parentName:"p"},"limit")," and/or ",(0,l.kt)("inlineCode",{parentName:"p"},"offset"),".\nThis will also change the return type from a ",(0,l.kt)("inlineCode",{parentName:"p"},"CursorConnection")," to an ",(0,l.kt)("inlineCode",{parentName:"p"},"OffsetConnection"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ pagingStrategy: PagingStrategies.OFFSET })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("p",null,"To disable paging entirely you can use the ",(0,l.kt)("inlineCode",{parentName:"p"},"NONE")," ",(0,l.kt)("inlineCode",{parentName:"p"},"pagingStrategy"),". When using ",(0,l.kt)("inlineCode",{parentName:"p"},"NONE")," an ",(0,l.kt)("inlineCode",{parentName:"p"},"ArrayConnection")," will be returned."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ pagingStrategy: PagingStrategies.NONE })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h3",{id:"paging-with-total-count"},"Paging with Total Count"),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"This section ",(0,l.kt)("strong",{parentName:"p"},"ONLY")," applies to ",(0,l.kt)("inlineCode",{parentName:"p"},"CURSOR")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"OFFSET")," connections.")),(0,l.kt)("admonition",{type:"warning"},(0,l.kt)("p",{parentName:"admonition"},"Enabling ",(0,l.kt)("inlineCode",{parentName:"p"},"totalCount")," can be expensive. If your table is large the ",(0,l.kt)("inlineCode",{parentName:"p"},"totalCount")," query may be expensive, use with caution.")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"The ",(0,l.kt)("inlineCode",{parentName:"p"},"totalCount")," field is not eagerly fetched. It will only be executed if the field is queried from the client.")),(0,l.kt)("p",null,"When using the ",(0,l.kt)("inlineCode",{parentName:"p"},"CURSOR")," (the default) or ",(0,l.kt)("inlineCode",{parentName:"p"},"OFFSET")," paging strategy you have the option to expose a ",(0,l.kt)("inlineCode",{parentName:"p"},"totalCount")," field to\nallow clients to fetch a total count of records in a connection."),(0,l.kt)("p",null,"To enable the ",(0,l.kt)("inlineCode",{parentName:"p"},"totalCount")," field for connections set the ",(0,l.kt)("inlineCode",{parentName:"p"},"enableTotalCount")," option to ",(0,l.kt)("inlineCode",{parentName:"p"},"true")," using the\n",(0,l.kt)("inlineCode",{parentName:"p"},"@QueryOptions")," decorator."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ enableTotalCount: true })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("p",null,"When setting ",(0,l.kt)("inlineCode",{parentName:"p"},"enableTotalCount")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"true")," you will be able to query for ",(0,l.kt)("inlineCode",{parentName:"p"},"totalCount")," on ",(0,l.kt)("inlineCode",{parentName:"p"},"cursor")," or offset connections"),(0,l.kt)(r.Z,{defaultValue:"graphql",values:[{label:"GraphQL",value:"graphql"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"graphql",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  todoItems {\n    totalCount\n    pageInfo {\n      hasNextPage\n      hasPreviousPage\n      startCursor\n      endCursor\n    }\n    edges {\n      node {\n        id\n        title\n        description\n      }\n    }\n  }\n}\n\n"))),(0,l.kt)(o.Z,{value:"response",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "todoItems": {\n      "totalCount": 5,\n      "pageInfo": {\n        "hasNextPage": false,\n        "hasPreviousPage": false,\n        "startCursor": "YXJyYXljb25uZWN0aW9uOjA=",\n        "endCursor": "YXJyYXljb25uZWN0aW9uOjQ="\n      },\n      "edges": [\n        {\n          "node": {\n            "id": "1",\n            "title": "Create Nest App",\n            "description": null\n          }\n        },\n        {\n          "node": {\n            "id": "2",\n            "title": "Create Entity",\n            "description": null\n          }\n        },\n        {\n          "node": {\n            "id": "3",\n            "title": "Create Entity Service",\n            "description": null\n          }\n        },\n        {\n          "node": {\n            "id": "4",\n            "title": "Add Todo Item Resolver",\n            "description": null\n          }\n        },\n        {\n          "node": {\n            "id": "5",\n            "title": "How to create item With Sub Tasks",\n            "description": null\n          }\n        }\n      ]\n    }\n  }\n}\n')))),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"default-sort"},"Default Sort"),(0,l.kt)("p",null,"When querying the default is based on the persistence layer. You can override the default by providing the ",(0,l.kt)("inlineCode",{parentName:"p"},"defaultSort")," option."),(0,l.kt)("p",null,"In this example we specify the default sort to be by ",(0,l.kt)("inlineCode",{parentName:"p"},"title"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { SortDirection } from '@ptc-org/nestjs-query-core';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ defaultSort: [{ field: 'title', direction: SortDirection.ASC }] })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("h3",{id:"allowed-boolean-expressions"},"Allowed Boolean Expressions"),(0,l.kt)("p",null,"When filtering you can provide ",(0,l.kt)("inlineCode",{parentName:"p"},"and")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"or")," expressions to provide advanced filtering. You can turn off either by\nusing the ",(0,l.kt)("inlineCode",{parentName:"p"},"allowedBooleanExpressions")," option."),(0,l.kt)("p",null,"In this example we will only allow ",(0,l.kt)("inlineCode",{parentName:"p"},"and")," expressions."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5}',title:'"todo-item.dto.ts"',"{5}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ allowedBooleanExpressions: ['and'] })\nexport class TodoItemDTO {\n  @IDField(() => ID)\n  id!: string;\n\n  @FilterableField()\n  title!: string;\n\n  @FilterableField()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")),(0,l.kt)("p",null,"To turn off all boolean expressions you can set ",(0,l.kt)("inlineCode",{parentName:"p"},"allowedBooleanExpressions")," to an empty array. This is useful if you\nonly allow filtering on certain fields and you want to disable all complex filtering."),(0,l.kt)("p",null,"In this example we will only allow ",(0,l.kt)("inlineCode",{parentName:"p"},"eq")," comparisons on the id field and disable all ",(0,l.kt)("inlineCode",{parentName:"p"},"and"),"/",(0,l.kt)("inlineCode",{parentName:"p"},"or")," boolean expressions."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-item.dto.ts" {5,7}',title:'"todo-item.dto.ts"',"{5,7}":!0},"import { FilterableField, IDField, QueryOptions, PagingStrategies } from '@ptc-org/nestjs-query-graphql';\nimport { ObjectType, ID, GraphQLISODateTime, Field } from '@nestjs/graphql';\n\n@ObjectType('TodoItem')\n@QueryOptions({ allowedBooleanExpressions: ['and'] })\nexport class TodoItemDTO {\n  @IDField(() => ID, { allowedComparisons: ['eq'] })\n  id!: string;\n\n  @Field()\n  title!: string;\n\n  @Field()\n  completed!: boolean;\n\n  @Field(() => GraphQLISODateTime)\n  created!: Date;\n\n  @Field(() => GraphQLISODateTime)\n  updated!: Date;\n}\n\n")))}f.isMDXComponent=!0}}]);